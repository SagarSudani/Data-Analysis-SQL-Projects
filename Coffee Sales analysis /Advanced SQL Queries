## Previous Month and Current Month Total Sales with Increase Percentage
WITH monthly_sales AS (                                  
  SELECT 
    MONTH(transaction_date) AS month,                            
    SUM(unit_price * transaction_qty) AS total_sales          -- total sales 
  FROM coffeeshopsales
  WHERE MONTH(transaction_date) IN (4,5)      -- for month april(pm) and may (cm)
  GROUP BY MONTH(transaction_date)
)
SELECT 
  month,
  total_sales,
  ROUND(
    (total_sales - LAG(total_sales) OVER (ORDER BY month))                
    / LAG(total_sales) OVER (ORDER BY month) * 100, 2        -- percentage increase previous month
  ) AS increase_percentage
FROM monthly_sales
ORDER BY month;


 ##weekdays and weekend Total sales
 SELECT 
	case when dayofweek(transaction_date) in (1,7) then 'weekend'
	else 'weekdays'
	end as day_type,
	concat(round(sum(unit_price * transaction_qty)/1000,1),'K') as total_sales
 from coffeeshopsales
 where month(transaction_date) = 5
 group by
 case when dayofweek(transaction_date) in (1,7) then 'weekend'
 else 'weekdays'
 end;
select 
	concat(round(avg(total_sales)/1000,1),'K') as avg_sales
    from(
    select sum(unit_price * transaction_qty) as total_sales
    from coffeeshopsales
    where 
    month(transaction_date) = 4
    group by transaction_date
    ) as internal_query


#sales status and Total sales By each day of month
select 
day_of_month,
case
when total_sales > avg_sales then 'above average'
when total_sales < avg_sales then 'below average'
else 'average'
end as sales_status,
total_sales
from (
select
sum(unit_price * transaction_qty) as total_sales,
day(transaction_date) as day_of_month,
avg(sum(unit_price * transaction_qty)) over() as avg_sales 
from coffeeshopsales
where
 month(transaction_date) = 5
 group by day(transaction_date)
) as sales_data
order by day_of_month ;


## Total Orders by previous month and current month with increase percentage
WITH monthly_sales AS (                                  
  SELECT 
    MONTH(transaction_date) AS month,                            
    count(transaction_id) AS total_orders          -- total orders 
  FROM coffeeshopsales
  WHERE MONTH(transaction_date) IN (4,5)      -- for month april(pm) and may (cm)
  GROUP BY MONTH(transaction_date)
)
SELECT 
  month,
  total_orders,
  ROUND(
    (total_orders - LAG(total_orders) OVER (ORDER BY month))                
    / LAG(total_orders) OVER (ORDER BY month) * 100, 2        
  ) AS increase_percentage
FROM monthly_sales
ORDER BY month;


# Total Quantity sold by previous month and current month with increase percentage
WITH monthly_sales AS (                                  
  SELECT 
    MONTH(transaction_date) AS month,                            
    sum(transaction_qty) AS total_quantity_sold          -- total orders 
  FROM coffeeshopsales
  WHERE MONTH(transaction_date) IN (4,5)      -- for month april(pm) and may (cm)
  GROUP BY MONTH(transaction_date)
)
SELECT 
  month,
  total_quantity_sold,
  ROUND(
    (total_quantity_sold - LAG(total_quantity_sold) OVER (ORDER BY month))                
    / LAG(total_quantity_sold) OVER (ORDER BY month) * 100, 2        
  ) AS increase_percentage
FROM monthly_sales
ORDER BY month;



